---
layout: ""
page_title: dynatrace_kubernetes_enrichment Resource - terraform-provider-dynatrace"
subcategory: "Cloud Platforms"
description: |-
  The resource `dynatrace_kubernetes_enrichment` covers configuration for generic metadata enrichment rules for Kubernetes
---

# dynatrace_kubernetes_app (Resource)

-> This resource requires the API token scopes **Read settings** (`settings.read`) and **Write settings** (`settings.write`)

## Dynatrace Documentation

- Kubernetes app - https://docs.dynatrace.com/docs/platform-modules/infrastructure-monitoring/container-platform-monitoring/kubernetes-app

- Settings API - https://www.dynatrace.com/support/help/dynatrace-api/environment-api/settings (schemaId: `builtin:kubernetes.generic.metadata.enrichment`)

## Export Example Usage

- `terraform-provider-dynatrace -export dynatrace_kubernetes_enrichment` downloads all existing generic metadata enrichment rules for Kubernetes

The full documentation of the export feature is available [here](https://dt-url.net/h203qmc).

## Resource Example Usage

```terraform
resource "dynatrace_kubernetes_enrichment" "#name#" {
  scope = "environment"
  rules {
    rule {
      type    = "LABEL"
      source  = "#name#"
      target  = "dt.cost.product"
    }
    rule {
      type    = "LABEL"
      source  = "#name#"
      primary_grail_tag = true
    }
    rule {
      type    = "LABEL"
      source  = "#name#"
      target  = "dt.cost.product"
      primary_grail_tag = false
    }
    rule {
      type    = "ANNOTATION"
      source  = "#name#"
      target  = "dt.security_context"
    }
    rule {
      type    = "ANNOTATION"
      source  = "#name#"
      primary_grail_tag = true
    }
    rule {
      type    = "ANNOTATION"
      source  = "#name#"
      target  = "dt.security_context"
      primary_grail_tag = false
    }
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Optional

- `rules` (Block List, Max: 1) Dynatrace allows to use metadata defined on Kubernetes nodes, namespaces, and pods to set security and cost allocation attributes and dimensions for metrics, events, log, spans, and entities associated with the respective Kubernetes resource. 

 The following annotation keys are considered: 
 * `metadata.dynatrace.com/dt.security_context` 
 * `metadata.dynatrace.com/dt.cost.product` 
 * `metadata.dynatrace.com/dt.cost.costcenter` 

 Pod annotations determine the attributes of data associated with the pod itself, and containers belonging to the pod. 

Namespace annotations determine the attributes of data associated with the namespace itself, workloads, services, and - if not overwritten on pod level - pods, and containers belonging to the namespace. 

Node annotations determine the attributes of data associated with only the node. 

 Depending on your specific use case and environment, you have the following enrichment options: 

 **Manual annotation:** 

 Use the aforementioned annotation keys when annotating your namespaces and pods to enrich your Kubernetes data with security and cost allocation attributes.

With Dynatrace Operator version 1.3.0, the aforementioned namespace annotations are copied down to pods in the namespace, if they are not yet set on the respective pod. 

 **Rule-based annotation:**

If you already have labels or annotations defined on your namespaces, and you want to reuse them for enrichment, you can do so with the help of rules definable here. 

**Example:**

 * Namespace label:
   * `label/example: test-value`

 * Rule: 
   * `Label` 
 `label/example --> dt.security_context`

 * Pod annotation: 
   * `metadata.dynatrace.com/dt.security_context: test-value`

A maximum of 5 rules can be defined. The first applicable rule will be applied. Preexisting annotations will not be overwritten. For a detailed description of this feature, have a look at our [documentation](https://dt-url.net/pn22sye). (see [below for nested schema](#nestedblock--rules))
- `scope` (String) The scope of this setting (KUBERNETES_CLUSTER). Omit this property if you want to cover the whole environment.

### Read-Only

- `id` (String) The ID of this resource.

<a id="nestedblock--rules"></a>
### Nested Schema for `rules`

Required:

- `rule` (Block List, Min: 1) (see [below for nested schema](#nestedblock--rules--rule))

<a id="nestedblock--rules--rule"></a>
### Nested Schema for `rules.rule`

Required:

- `source` (String) The source must follow the syntax of Kubernetes annotation/label keys as defined in the [Kubernetes documentation](https://dt-url.net/2c02sbn).

`source := (prefix/)?name`

`prefix := [a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*`

`name := ([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9]`

Additionally, the name can have at most 63 characters, and the overall length of the source must not exceed 75 characters.
- `type` (String) Possible Values: `ANNOTATION`, `LABEL`

Optional:

- `enabled` (Boolean, Deprecated) This setting is enabled (`true`) or disabled (`false`)
- `primary_grail_tag` (Boolean) Uses the key of the annotation or label as field name
- `target` (String) Required when `primary_grail_tag` is omitted or `false`. Possible Values: `dt.cost.costcenter``, `dt.cost.product``, `dt.security_context
 