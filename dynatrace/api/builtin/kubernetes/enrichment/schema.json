{
	"allowedScopes": [
		"KUBERNETES_CLUSTER",
		"environment"
	],
	"description": "Generic metadata enrichment for Kubernetes.",
	"displayName": "Kubernetes Telemetry Enrichment",
	"documentation": "",
	"dynatrace": "1",
	"enums": {
		"MetadataType": {
			"description": "",
			"displayName": "MetadataType",
			"documentation": "",
			"items": [
				{
					"displayName": "Annotation",
					"value": "ANNOTATION"
				},
				{
					"displayName": "Label",
					"value": "LABEL"
				}
			],
			"type": "enum"
		},
		"TargetOption": {
			"description": "",
			"displayName": "TargetOption",
			"documentation": "",
			"items": [
				{
					"displayName": "dt.security_context",
					"value": "dt.security_context"
				},
				{
					"displayName": "dt.cost.product",
					"value": "dt.cost.product"
				},
				{
					"displayName": "dt.cost.costcenter",
					"value": "dt.cost.costcenter"
				}
			],
			"type": "enum"
		}
	},
	"maxObjects": 1,
	"multiObject": false,
	"properties": {
		"rules": {
			"constraints": [
				{
					"customMessage": "The amount of defined rules exceeds the maximum",
					"customValidatorId": "kubernetes-enrichment-rule-count",
					"skipAsyncValidation": false,
					"type": "CUSTOM_VALIDATOR_REF"
				}
			],
			"description": "Kubernetes Telemetry Enrichment empowers you to effectively tag your telemetry data using Kubernetes labels and annotations. Additionally, it enables you to tag it for cost allocation and permission purposes.\n\nEnrichment Options:\n\n- **Primary Grail Tags:** Tag your telemetry data with existing Kubernetes labels or annotations. These will be made available as domain-specific fields (e.g., `k8s.namespace.label.your_key`). This allows for flexible pipeline routing, bucket selection, segmentation, and filtering.\n\n- **Security Context and Cost Allocation:** Leverage existing Kubernetes labels or annotations  as the basis for security context or cost allocation. This provides granular control over permissions and facilitates chargeback functionalities.\n\nAdditional Information:\n\n- You can define up to 20 enrichment rules.\n\n- New rules may take up to 45 minutes to become effective.\n\n- After the rules are applied, pod restarts are required to ensure the changes take effect.\n\nTo learn more, please refer to our [documentation](https://dt-url.net/pn22sye).",
			"displayName": "",
			"documentation": "",
			"items": {
				"description": "",
				"displayName": "",
				"documentation": "",
				"type": {
					"$ref": "#/types/Rule"
				}
			},
			"maxObjects": 100,
			"metadata": {
				"addItemButton": "Add rule"
			},
			"minObjects": 0,
			"modificationPolicy": "DEFAULT",
			"nullable": false,
			"type": "list"
		}
	},
	"schemaGroups": [
		"group:cloud-and-virtualization"
	],
	"schemaId": "builtin:kubernetes.generic.metadata.enrichment",
	"types": {
		"Rule": {
			"description": "",
			"displayName": "Rule",
			"documentation": "",
			"properties": {
				"primaryGrailTag": {
					"description": "",
					"displayName": "Use as Primary Grail Tag",
					"documentation": "Uses the key of the annotation or label as field name",
					"maxObjects": 1,
					"modificationPolicy": "DEFAULT",
					"nullable": true,
					"type": "boolean"
				},
				"source": {
					"constraints": [
						{
							"customMessage": "The source must not be empty. The name can have at most 63 characters and the overall length of the source must not exceed 75 characters.",
							"maxLength": 75,
							"minLength": 1,
							"type": "LENGTH"
						},
						{
							"customMessage": "The source must follow the syntax of Kubernetes annotation/label keys. Check the tooltip for more information",
							"customValidatorId": "kubernetes-enrichment-source-format",
							"skipAsyncValidation": false,
							"type": "CUSTOM_VALIDATOR_REF"
						}
					],
					"default": "",
					"description": "",
					"displayName": "Source",
					"documentation": "The source must follow the syntax of Kubernetes annotation/label keys as defined in the [Kubernetes documentation](https://dt-url.net/2c02sbn).\n\n`source := (prefix/)?name`\n\n`prefix := [a-z0-9]([-a-z0-9]*[a-z0-9])?(\\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*`\n\n`name := ([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9]`\n\nAdditionally, the name can have at most 63 characters, and the overall length of the source must not exceed 75 characters.",
					"maxObjects": 1,
					"modificationPolicy": "DEFAULT",
					"nullable": false,
					"type": "text"
				},
				"target": {
					"default": "dt.security_context",
					"description": "",
					"displayName": "Target",
					"documentation": "",
					"maxObjects": 1,
					"modificationPolicy": "DEFAULT",
					"nullable": false,
					"precondition": {
						"preconditions": [
							{
								"property": "primaryGrailTag",
								"type": "NULL"
							},
							{
								"expectedValue": false,
								"property": "primaryGrailTag",
								"type": "EQUALS"
							}
						],
						"type": "OR"
					},
					"type": {
						"$ref": "#/enums/TargetOption"
					}
				},
				"type": {
					"default": "ANNOTATION",
					"description": "",
					"displayName": "Metadata type",
					"documentation": "",
					"maxObjects": 1,
					"modificationPolicy": "DEFAULT",
					"nullable": false,
					"type": {
						"$ref": "#/enums/MetadataType"
					}
				}
			},
			"summaryPattern": "{type} {source} --\u003e {target}",
			"type": "object",
			"version": "0",
			"versionInfo": ""
		}
	},
	"version": "1.4"
}