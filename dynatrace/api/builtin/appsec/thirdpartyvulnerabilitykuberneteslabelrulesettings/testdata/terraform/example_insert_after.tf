resource "dynatrace_vulnerability_third_party_k8s" "first-instance" {
  enabled      = false
  rule_name    = "#name#-first"
  kubernetes_label_conditions {
    kubernetes_label_condition {
      kubernetes_label_key   = "kubernetes.azure.com/cluster"
      kubernetes_label_value = "#name#"
      matcher                = "EQUALS"
    }
  }
  metadata {
    comment = ""
  }
  vulnerability_detection_control {
    monitoring_mode = "MONITORING_ON"
  }
}

resource "dynatrace_vulnerability_third_party_k8s" "second-instance" {
  enabled      = false
  insert_after = "${dynatrace_vulnerability_third_party_k8s.first-instance.id}"
  rule_name    = "#name#-second"
  kubernetes_label_conditions {
    kubernetes_label_condition {
      kubernetes_label_key   = "kubernetes.azure.com/mode"
      kubernetes_label_value = "#name#"
      matcher                = "NOT_EQUALS"
    }
    kubernetes_label_condition {
      kubernetes_label_key   = "agentpool"
      kubernetes_label_value = "#name#"
      matcher                = "CONTAINS"
    }
  }
  metadata {
    comment = "#name#"
  }
  vulnerability_detection_control {
    monitoring_mode = "MONITORING_OFF"
  }
}
